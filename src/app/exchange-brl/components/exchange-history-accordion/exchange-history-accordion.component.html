<section class="w-full" data-cy="history-accordion">
  <button type="button" class="w-full flex items-center justify-between py-2 cursor-pointer"
    (click)="expanded = !expanded" data-cy="accordion-toggle" [attr.aria-expanded]="expanded">
    <span class="text-[#262626] text-[14px] font-bold uppercase">LAST 30 DAYS</span>

    <span class="text-[#07B0FB] text-2xl leading-none" data-cy="accordion-icon" aria-hidden="true">
      {{ expanded ? '−' : '+' }}
    </span>
  </button>

  <div *ngIf="!expanded" class="h-[2px] w-full bg-[#07B0FB]" data-cy="accordion-divider"></div>

  <div *ngIf="expanded" class="bg-[#F4F4F4] p-3 pb-4" data-cy="accordion-body">
    <div class="grid grid-cols-1 gap-3 lg:grid-cols-2">
      <article *ngFor="let item of sortedItems; let i = index" class="bg-white border border-[#E5E5E5] rounded-sm p-4"
        data-cy="history-card" [attr.data-cy-index]="i">
        <p class="mb-3 text-[14px] font-semibold text-[#07B0FB]" data-cy="history-date">
          {{ item.date | date:'dd/MM/yyyy' }}
        </p>

        <div class="grid grid-cols-2 gap-y-2 gap-x-4 items-center">
          <div class="flex items-baseline gap-3">
            <p class="text-[10px] uppercase text-[#3F3F3F] whitespace-nowrap font-semibold">Open:</p>
            <span class="flex items-baseline gap-1">
              <span class="text-[16px] font-bold text-[#3F3F3F]">R$</span>
              <span class="text-[16px] font-bold text-[#3F3F3F]" data-cy="open">
                {{ item.open | number:'1.4-4' }}
              </span>
            </span>
          </div>

          <div class="flex items-baseline gap-2">
            <p class="text-[10px] uppercase text-[#3F3F3F] whitespace-nowrap font-semibold">Hight:</p>
            <span class="flex items-baseline gap-1">
              <span class="text-[16px] font-bold text-[#3F3F3F]">R$</span>
              <span class="text-[16px] font-bold text-[#3F3F3F]" data-cy="high">
                {{ item.high | number:'1.4-4' }}
              </span>
            </span>
          </div>

          <div class="flex items-baseline gap-2">
            <p class="text-[10px] uppercase text-[#3F3F3F] whitespace-nowrap font-semibold">Close:</p>
            <span class="flex items-baseline gap-1">
              <span class="text-[16px] font-bold text-[#3F3F3F]">R$</span>
              <span class="text-[16px] font-bold text-[#3F3F3F]" data-cy="close">
                {{ item.close | number:'1.4-4' }}
              </span>
            </span>
          </div>

          <div class="flex items-baseline gap-4">
            <p class="text-[10px] uppercase text-[#3F3F3F] whitespace-nowrap font-semibold">Low:</p>
            <span class="flex items-baseline gap-1">
              <span class="text-[16px] font-bold text-[#3F3F3F]">R$</span>
              <span class="text-[16px] font-bold text-[#3F3F3F]" data-cy="low">
                {{ item.low | number:'1.4-4' }}
              </span>
            </span>
          </div>
        </div>

        <div class="mt-2 flex items-center gap-2">
          <p class="text-[11px] uppercase text-[#3F3F3F] font-semibold">Close diff (%):</p>

          <span class="inline-flex items-center text-[15px] font-bold" data-cy="close-diff"
            [class.text-[#69C669]]="item.closeDiffPct !== null && item.closeDiffPct >= 0"
            [class.text-[#E54E4E]]="item.closeDiffPct !== null && item.closeDiffPct < 0">
            {{
            item.closeDiffPct === null
            ? '—'
            : (item.closeDiffPct >= 0 ? '+' : '') + (item.closeDiffPct | number:'1.2-2') + '%'
            }}
          </span>

          <span *ngIf="item.closeDiffPct !== null"
            class="inline-flex items-center justify-center text-[15px] leading-none font-bold"
            [class.text-[#69C669]]="item.closeDiffPct >= 0" [class.text-[#E54E4E]]="item.closeDiffPct < 0"
            [class.rotate-180]="item.closeDiffPct < 0" style="display:inline-flex" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M2.5 9.25 L7 4.75 L11.5 9.25" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </span>
        </div>
      </article>
    </div>
  </div>
</section>
